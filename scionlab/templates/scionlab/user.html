{% extends 'scionlab/base.html' %}
{% load static %}

{% block title %}User ASes{% endblock %}

{% block content %}
<div class="wrapper">

  <div class="spacer"></div>
  <h3>Welcome to SCIONLab!</h3>

  {%  if grafana_url|length > 0 %}
  <span>
    <a target="_blank" rel="noopener noreferrer" href="{{ grafana_url }}">Grafana Monitor</a>
  </span>
  {% endif %}


  <div class="alert alert-info">
    <p>
      {%  if as_count == 0 %}
      <span>
        You currently have no registered SCIONLab ASes.
      </span>
      {% endif %}
      {%  if as_count > 0 %}
      <span>
        You currently have <strong>{{ as_count }}</strong> SCIONLab AS{{ as_count|pluralize:"es" }}.
      </span>
      {% endif %}
      {%  if as_count < quota %}
      <span>
        You can create up to {{ quota }} ASes with your account.
        Please use the button below.
      </span>
      {% endif %}
      {%  if as_count >= quota %}
      <span>
        You have reached the maximum number of ASes and cannot create further ones.
      </span>
      {% endif %}
    </p>
  </div>

  {%  if as_count <= quota %}
  <button onclick="alert('Here be: generateSCIONLabAS()');"
          class="btn btn-success btn-block">
    Generate a new SCIONLab AS
  </button>
  <br/>
  {% endif %}

  {%  if as_count > 0 %}
  <div>
    <p>
      You can configure and download you SCIONLab AS configurations using the form below.
      Please extract the downloaded tarball in a desired location and refer to the
      README.md file inside or the <a href="https://netsec-ethz.github.io/scion-tutorials/">
      SCION tutorials</a> for instructions.
    </p>
    <p>
      If you have a static public IP address, please select that option below and specify your IP
      address and the port you want to use for the connection (default: 50000).
      Otherwise, a VPN-based setup is set up for you, such that you do not need to apply any
      further configuration.
    </p>
  </div>
  {% endif %}

  <div>
    <span>You can change your password <a href="{% url 'password_reset' %}">here</a>.</span>
  </div>

  <div class="spacer"></div>

  {% regroup user_ases|dictsort:"is_core" by is_core as core_list %}
  <select class="form-control btn btn-primary dropdown-toggle">
      {% for is_core_entry, entries in core_list reversed %}
          <optgroup label="{{ is_core_entry|yesno:"Core,Regular" }}">
            {% for user_as in entries %}
            <option>{{ user_as.as_id }} ({{ user_as.label }})</option>
            {% endfor %}
          </optgroup>
      {% endfor %}
  </select>

  <strong>
    This AS is currently STATUS
  </strong>
  <p></p>
  <form name="scionLabASForm">
    <div class="form-group has-feedback">
      <label>Attachment point to connect to</label>
        {% regroup attachment_points|dictsort:"isd_id" by isd_id as isd_list %}
        <select name="AP" class="form-control dropdown-toggle">
            {% for isd_id, aps in isd_list %}
              <optgroup label="ISD {{ isd_id }}">
                {% for ap in aps %}
                <option>{{ ap.as_id }} ({{ ap.label }})</option>
                {% endfor %}
              </optgroup>
            {% endfor %}
        </select>
      <span class="glyphicon glyphicon-cloud form-control-feedback"></span>
    </div>
    <div class="form-group has-feedback">
      <label>Label for this AS (optional)</label>
      <input type="text" class="form-control" name="Label"
             placeholder="Label for this AS">
      <span class="glyphicon glyphicon-pencil form-control-feedback"></span>
    </div>
    <div class="form-group">
      <div class="radio">
        <label><input type="radio" value="1">
          Install inside a virtual machine
        </label>
      </div>
      <div class="radio">
        <label><input type="radio" value="2">
          Install on a dedicated SCION system (for experts)
        </label>
      </div>
    </div>
    {% if vpn_support_enabled %}
    <div class="form-group checkbox">
        <label>
          <input type="checkbox" name="IsVPN">
          Use an OpenVPN connection for this AS
        </label>
    </div>
    {% endif %}
    {% if not vpn_support_enabled %}
    <div class="form-group has-feedback">
      <label>My host's public IP address</label>
      <input type="text" class="form-control" name="IP"
             placeholder="My host's public IP address">
      <span class="glyphicon glyphicon-home form-control-feedback"></span>
    </div>
    <div class="form-group has-feedback">
      <label>Port where this AS accepts traffic</label>
      <input type="number" class="form-control" min="1024" max="65535" required
             name="Port" placeholder="Port (default: 50000)">
      <span class="glyphicon glyphicon-log-in form-control-feedback"></span>
    </div>
    {% endif %}

    <div class="form-group">
      <div class="col-xs-12">
        <div id="buttongroup">
          <div class="btn-group" role="group">
            <button onclick="alert('Here be: submitForm(button.Action, user, asInfo)');"
                    class="btn btn-primary {{button.Class}}" data-toggle="tooltip"
                    title="tooltip">
              Create and Download SCIONLab AS Configuration
            </button>
          </div>
        </div>
      </div>
    </div>
  </form>


  {%  if as_count > 0 %}
  <div>
    <div>
      <h3>Create SCION image for IoT device</h3>
      <p>
        This option allows you to generate prebuilt images for some of the most popular IoT devices that contain a preinstalled SCION AS.
        For this option to be enabled you must select the option <strong>"Install on a dedicated SCION system"</strong>.
        Choose the device you have and click on <strong>"Build image"</strong>.
      </p>
    </div>

    <div class="d-flex">
      <div class="col-xs-4">
        <select class="form-control btn btn-primary dropdown-toggle">
              <option value="">Select image</option>
              {% for img in iot_images %}
                <option>{{ img.display_name }}</option>
              {% endfor %}
        </select>
      </div>

      <div class="col-xd-4">
          <button onclick="alert('Here be: buildImage(selectedImage, asInfo)');"
              class="btn btn-primary" data-toggle="tooltip"
              title="Build image" disabled="disabled">
            Build image
          </button>
      </div>
    </div>
    <br/>
    <div>

        <div class="col-xs-12">
            <h3>Available images will appear underneath</h3>

            <div id="buttongroup">

              <div class="btn-group" role="group">
                <button onclick="alert('Here be: downloadImage(userImg)');" class="btn btn-default" data-toggle="tooltip"
                disabled="disabled">
                  Download: Image name
                </button>
              </div>

            </div>
          </div>
    </div>
  </div>
  {%  endif %}

  <br/>
  <div class="spacer"></div>
</div>
{% endblock content %}
