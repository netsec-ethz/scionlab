FROM ethznetsec/scion_base:latest

ARG SCION_SRC
ARG SC

# Update
RUN sudo apt-get update && sudo apt-get install --assume-yes libpcap0.8 libpcap0.8-dev

# Checkout SCION
RUN git clone ${SCION_SRC} -b scionlab --depth 1 ${SC}

RUN sudo apt-get update && sudo apt-get install --assume-yes apt-transport-https
RUN sudo bash -c 'echo "deb [trusted=yes] https://packages.netsec.inf.ethz.ch/debian all main" >> /etc/apt/sources.list'
RUN sudo apt-get update && sudo apt-get install --assume-yes scionlab

COPY ./setup/reloadASConfig.sh ${SC}/reloadASConfig.sh
RUN sudo mkdir -p /var/log/scion/
RUN mkdir ${SC}/gen-cache


# Add environment variables for execution
ENV PYTHONPATH ${SC}/python
ENV SC ${SC}
